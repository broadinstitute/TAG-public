# BenchmarkCNV
BenchmarkCNV.wdl is designed to evaluate the performance of Dragen CNV (Copy Number Variation) caller against GATK SV (Structural Variation) caller. 
The pipeline is composed of three main steps:

* Select Variants
  * The pipeline first selects variants from the 1000 Genomes GATK SV callset, which serves as the ground truth for the evaluation.

* Large Variant Evaluation
  * The pipeline then uses the [wittyer](https://github.com/Illumina/witty.er) tool to evaluate the CNV variants discovered by the Dragen CNV caller and Dragen SV caller. 
  Wittyer is a tool that is specifically designed for large variant evaluation, and it is capable of comparing CNV and SV calls. 
  The pipeline benchmarks the results of the Dragen CNV caller and Dragen SV caller against GATK SV results to provide a comprehensive evaluation of the performance.

* Format Output
  * The final step of the pipeline uses the [Wittyer4mat](https://github.com/broadinstitute/TAG/pull/1567) script to parse the output generated by Wittyer into a well-formatted dataframe. 
  This allows for easy interpretation and analysis of the evaluation results.

## IMPORTANT NOTE
* The provided JSON is a ready to use example JSON template of the BenchmarkCNV workflow. It's using 1000 genome as callset input and HG00513 as an example. 
It is the userâ€™s responsibility to correctly set the reference and resource input variables. Please refer to [this terra
workspace](https://app.terra.bio/#workspaces/broadtagteam/tag1455_Dragen_CNV_Caller_Validaton) for Terra workspace setup.
* Here is the expected output from the example json inputs:
```
        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        | There are 3 variant events included in your input Wittyer.Stats.json |

        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    
Event 0 :  CopyNumberReference
Retrieving CopyNumberReference event stats from the input json file

Saving the retrieved CopyNumberReference stats into wittyer_cnv_CopyNumberReference_output.csv 

Markdown format of CopyNumberReference stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(kbp) |   Num Events |
|:---------------|---------:|------------:|----------:|--------------------:|-------------:|
| [1000, 5000)   |      nan |         nan |       nan |                   0 |            0 |
| [5000, 10000)  |      nan |         nan |       nan |                   0 |            0 |
| [10000, 20000) |      nan |           0 |       nan |                   0 |            0 |
| [20000, 50000) |      nan |           0 |       nan |                   0 |            0 |
| 50000+         |      nan |           0 |       nan |                   0 |            0 |

-------------------------------------------------------------------------------------------

Event 1 :  Deletion
Retrieving Deletion event stats from the input json file

Saving the retrieved Deletion stats into wittyer_cnv_Deletion_output.csv 

Markdown format of Deletion stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(kbp) |   Num Events |
|:---------------|---------:|------------:|----------:|--------------------:|-------------:|
| [1000, 5000)   |   0.0083 |    nan      |  nan      |               0     |          514 |
| [5000, 10000)  |   0.0523 |    nan      |  nan      |               0     |          149 |
| [10000, 20000) |   0.3617 |      0.5783 |    0.4451 |             281.734 |           48 |
| [20000, 50000) |   0.3898 |      0.5249 |    0.4474 |             480.452 |           40 |
| 50000+         |   0.2675 |      0.3309 |    0.2958 |             589.061 |           24 |

-------------------------------------------------------------------------------------------

Event 2 :  Duplication
Retrieving Duplication event stats from the input json file

Saving the retrieved Duplication stats into wittyer_cnv_Duplication_output.csv 

Markdown format of Duplication stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(kbp) |   Num Events |
|:---------------|---------:|------------:|----------:|--------------------:|-------------:|
| [1000, 5000)   |   0.27   |    nan      |  nan      |               0     |          112 |
| [5000, 10000)  |   0.0901 |    nan      |  nan      |               0     |          161 |
| [10000, 20000) |   0.0864 |      0.4806 |    0.1465 |             203.611 |           97 |
| [20000, 50000) |   0.1538 |      0.4316 |    0.2268 |             539.675 |           89 |
| 50000+         |   0.1899 |      0.4576 |    0.2684 |            1700.51  |           84 |

-------------------------------------------------------------------------------------------


        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

        | There are 6 variant events included in your input Wittyer.Stats.json |

        ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    
Event 0 :  Deletion
Retrieving Deletion event stats from the input json file

Saving the retrieved Deletion stats into wittyer_sv_Deletion_output.csv 

Markdown format of Deletion stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(event) |   Num Events |
|:---------------|---------:|------------:|----------:|----------------------:|-------------:|
| [50, 100)      |   0.9392 |      0.2045 |    0.3358 |                   374 |          444 |
| [100, 200)     |   0.9441 |      0.4096 |    0.5713 |                   317 |          304 |
| [200, 500)     |   0.8824 |      0.8367 |    0.859  |                  1158 |         1293 |
| [500, 1000)    |   0.5352 |      0.8451 |    0.6553 |                   180 |          327 |
| [1000, 10000)  |   0.7374 |      0.7189 |    0.7281 |                   463 |          636 |
| 10000+         |   0.2421 |      0.3594 |    0.2893 |                    23 |           95 |

-------------------------------------------------------------------------------------------

Event 1 :  Duplication
Retrieving Duplication event stats from the input json file

Saving the retrieved Duplication stats into wittyer_sv_Duplication_output.csv 

Markdown format of Duplication stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(event) |   Num Events |
|:---------------|---------:|------------:|----------:|----------------------:|-------------:|
| [50, 1000)     |   0.0014 |    nan      |  nan      |                     0 |          724 |
| [1000, 10000)  |   0.0897 |      0.25   |    0.1321 |                     8 |           78 |
| 10000+         |   0.024  |      0.4286 |    0.0455 |                     3 |          125 |

-------------------------------------------------------------------------------------------

Event 2 :  Insertion
Retrieving Insertion event stats from the input json file

Saving the retrieved Insertion stats into wittyer_sv_Insertion_output.csv 

Markdown format of Insertion stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(event) |   Num Events |
|:---------------|---------:|------------:|----------:|----------------------:|-------------:|
| [50, 100)      |   0.6471 |      0.3675 |    0.4688 |                   649 |          955 |
| [100, 200)     |   0.6914 |      0.417  |    0.5202 |                   329 |          619 |
| [200, 500)     |   0.8774 |      0.6596 |    0.7531 |                   558 |         1354 |
| [500, 1000)    |   0.5895 |      0.2747 |    0.3748 |                    25 |          190 |
| 1000+          |   0.4432 |      0.4651 |    0.4539 |                  1013 |          370 |

-------------------------------------------------------------------------------------------

Event 3 :  IntraChromosomeBreakend
Retrieving IntraChromosomeBreakend event stats from the input json file

Saving the retrieved IntraChromosomeBreakend stats into wittyer_sv_IntraChromosomeBreakend_output.csv 

Markdown format of IntraChromosomeBreakend stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(event) |   Num Events |
|:---------------|---------:|------------:|----------:|----------------------:|-------------:|
| [50, 1000)     |      nan |           0 |       nan |                     0 |            0 |
| [1000, 10000)  |      nan |           0 |       nan |                     0 |            0 |
| 10000+         |      nan |           0 |       nan |                     0 |            0 |

-------------------------------------------------------------------------------------------

Event 4 :  Inversion
Retrieving Inversion event stats from the input json file

Saving the retrieved Inversion stats into wittyer_sv_Inversion_output.csv 

Markdown format of Inversion stats:
| Event Length   |   Recall |   Precision |   F-Score |   QueryTpCount(event) |   Num Events |
|:---------------|---------:|------------:|----------:|----------------------:|-------------:|
| [50, 1000)     |      nan |         nan |       nan |                     0 |            0 |
| [1000, 10000)  |      nan |         nan |       nan |                     0 |            0 |
| 10000+         |      nan |         nan |       nan |                     0 |            0 |

-------------------------------------------------------------------------------------------

Event 5 :  TranslocationBreakend
Retrieving TranslocationBreakend event stats from the input json file

Saving the retrieved TranslocationBreakend stats into wittyer_sv_TranslocationBreakend_output.csv 

Markdown format of TranslocationBreakend stats:
| Event Length   | Recall   | Precision   | F-Score   | QueryTpCount(event)   | Num Events   |
|----------------|----------|-------------|-----------|-----------------------|--------------|

-------------------------------------------------------------------------------------------
```
